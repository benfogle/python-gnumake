
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>Makefile Functions &#8212; Py-gnumake 0.2 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Python Functions" href="python_funcs.html" />
    <link rel="prev" title="Installing and Using" href="installing_using.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="python_funcs.html" title="Python Functions"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="installing_using.html" title="Installing and Using"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Py-gnumake 0.2 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="makefile-functions">
<h1>Makefile Functions<a class="headerlink" href="#makefile-functions" title="Permalink to this headline">¶</a></h1>
<p>This section details the functions exported to the makefile by default.</p>
<p>None of the Python code run by the functions below is executed in a subprocess.
All code shares the same globals and imports, can interact with the makefile,
etc.</p>
<p>Any errors encountered in the functions below will result in an empty
expansion.  See <a class="reference internal" href="exceptions.html"><span class="doc">Handling Exceptions</span></a> for more complete error-handling.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please excuse the syntax highlighting. The highlighter that can do makefile
and Python correctly together in the same snippet does not yet exist (and
probably never should).</p>
</div>
<div class="section" id="python-eval">
<span id="id1"></span><h2>python-eval<a class="headerlink" href="#python-eval" title="Permalink to this headline">¶</a></h2>
<p><strong>Usage:</strong>
<code class="docutils literal notranslate"><span class="pre">$(python-eval</span> <span class="pre">&lt;expression&gt;)</span></code></p>
<p><strong>Description:</strong> Expands to the result of a Python expression. Only single-line
Python expressions are allowed. The result is converted to a string according
to the rules given in <a class="reference internal" href="python_funcs.html#gnumake.export" title="gnumake.export"><code class="xref py py-func docutils literal notranslate"><span class="pre">export()</span></code></a>.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-makefile notranslate"><div class="highlight"><pre><span></span><span class="nv">FILE</span> <span class="o">:=</span> somefile
<span class="nv">RESULT1</span> <span class="o">:=</span> <span class="k">$(</span>python-eval <span class="s1">&#39;Hello&#39;</span><span class="k">)</span>
<span class="nv">RESULT2</span> <span class="o">:=</span> <span class="k">$(</span>python-eval <span class="m">1</span>+2+3+4<span class="k">)</span>
<span class="nv">RESULT3</span> <span class="o">:=</span> <span class="k">$(</span>python-eval os.path.getmtime<span class="o">(</span><span class="s1">&#39;$(FILE)&#39;</span><span class="k">)</span><span class="o">)</span>
<span class="k">$(</span><span class="nv">info</span> <span class="nv">RESULT1</span>=<span class="k">$(</span><span class="nv">RESULT1</span><span class="k">))</span>
<span class="k">$(</span><span class="nv">info</span> <span class="nv">RESULT2</span> = <span class="k">$(</span><span class="nv">RESULT2</span><span class="k">))</span>
<span class="k">$(</span><span class="nv">info</span> <span class="nv">RESULT3</span> = <span class="k">$(</span><span class="nv">RESULT3</span><span class="k">))</span>
</pre></div>
</div>
<p>This makefile snippet will print out something like:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>RESULT1 = Hello
RESULT2 = 10
RESULT3 = 1464398588.835386
</pre></div>
</div>
</div>
<div class="section" id="python-exec">
<span id="id2"></span><h2>python-exec<a class="headerlink" href="#python-exec" title="Permalink to this headline">¶</a></h2>
<p><strong>Usage:</strong> <code class="docutils literal notranslate"><span class="pre">$(python-exec</span> <span class="pre">&lt;expression&gt;)</span></code></p>
<p><strong>Description:</strong> Executes one or more Python statements. It is more convenient
to use <code class="docutils literal notranslate"><span class="pre">define</span></code> with this function if you want to execute multiple lines.
Anything written to stdout will be the result of his function’s expansion, much
like <code class="docutils literal notranslate"><span class="pre">$(shell</span> <span class="pre">...)</span></code>.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-makefile notranslate"><div class="highlight"><pre><span></span>$(python-exec import random) # Further Python code can now use random

RESULT1 := $(python-exec print(&quot;Random is&quot;, random.randint(1,100)))

# We expect no output here
RESULT2 := $(python-exec tmp1 = random.randint(1,100))

define python-code
tmp1 = random.randint(1,100)
tmp2 = random.randint(1,100)
print(&quot;tmp1*tmp2 = &quot;, tmp1*tmp2)
endef
RESULT3 := $(python-exec $(python-code))

$(info RESULT1 = $(RESULT1))
$(info RESULT2 = $(RESULT2))
$(info RESULT3 = $(RESULT3))
</pre></div>
</div>
<p>This makefile snippet will print out something like:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>RESULT1 = Random is 47
RESULT2 =
RESULT3 = tmp1*tmp2 =  7760
</pre></div>
</div>
</div>
<div class="section" id="python-file">
<span id="id3"></span><h2>python-file<a class="headerlink" href="#python-file" title="Permalink to this headline">¶</a></h2>
<p><strong>Usage:</strong> <code class="docutils literal notranslate"><span class="pre">$(python-file</span> <span class="pre">&lt;script&gt;,&lt;arg1&gt;,&lt;arg2&gt;,...)</span></code></p>
<p><strong>Description:</strong> Exactly like <a class="reference internal" href="#python-exec"><span class="std std-ref">$(python-exec …)</span></a> but
executes statements from a file. Any arguments will be passed to the script in
<code class="docutils literal notranslate"><span class="pre">sys.argv</span></code>. Note that the script is not run in a separate process and it
shares globals with other Python code.</p>
<p><strong>Example</strong>:</p>
<p>The file python.py contains the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">global1</span> <span class="o">=</span> <span class="s1">&#39;abc&#39;</span>

<span class="n">pattern</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">strings</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Matches:&quot;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">strings</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">s</span><span class="p">)))</span>
</pre></div>
</div>
<p>The makefile snippet contains the following:</p>
<div class="highlight-makefile notranslate"><div class="highlight"><pre><span></span><span class="c"># Match words where the first and last letters are the same</span>
<span class="c"># Note double $$ in pattern</span>
<span class="nv">PAT</span> <span class="o">=</span> ^<span class="o">(</span>.<span class="o">)</span>.*<span class="se">\1</span><span class="nv">$$</span>
<span class="nv">RESULT1</span> <span class="o">=</span> <span class="k">$(</span>python-file python.py,<span class="k">$(</span>PAT<span class="k">)</span>,dare,dead,edge,tooth<span class="k">)</span>
<span class="nv">RESULT2</span> <span class="o">=</span> <span class="k">$(</span>python-eval global1<span class="k">)</span>

<span class="k">$(</span><span class="nv">info</span> <span class="nv">RESULT1</span> = <span class="k">$(</span><span class="nv">RESULT1</span><span class="k">))</span>
<span class="k">$(</span><span class="nv">info</span> <span class="nv">RESULT2</span> = <span class="k">$(</span><span class="nv">RESULT2</span><span class="k">))</span>
</pre></div>
</div>
<p>This snippet will produce the following output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>RESULT1 = Matches: dead edge
RESULT2 = abc
</pre></div>
</div>
</div>
<div class="section" id="python-mod">
<span id="id4"></span><h2>python-mod<a class="headerlink" href="#python-mod" title="Permalink to this headline">¶</a></h2>
<p><strong>Usage:</strong> <code class="docutils literal notranslate"><span class="pre">$(python-mod</span> <span class="pre">&lt;mod&gt;(.&lt;submod&gt;))</span></code></p>
<p><strong>Description:</strong> Similar to <a class="reference internal" href="#python-file"><span class="std std-ref">$(python-file …)</span></a> but only
exposes the &#64;gnumake.export functions from the module into the Makefile. Note
that different modules are isolated - so global variables will not be visible.</p>
<p><strong>Example</strong>:</p>
<p>A Python module needs to be declared that contains an <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> file. It
can also contain any number of Python files to sub-divide the module. For
example my_mod/example.py contains the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gnumake</span>

<span class="nd">@gnumake</span><span class="o">.</span><span class="n">export</span>
<span class="k">def</span> <span class="nf">say_hello</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;Hello &quot;</span> <span class="o">+</span> <span class="n">arg</span> <span class="o">+</span> <span class="s2">&quot;!&quot;</span>
</pre></div>
</div>
<p>The makefile then contains the following:</p>
<div class="highlight-makefile notranslate"><div class="highlight"><pre><span></span><span class="c"># Import the Python module</span>
<span class="k">$(</span><span class="nv">python-mod</span> <span class="nv">my_mod.example</span><span class="k">)</span>

<span class="c"># Invoke the test function</span>
<span class="k">$(</span><span class="nv">info</span> <span class="nv">RESPONSE</span> = <span class="k">$(</span><span class="nv">say_hello</span> <span class="nv">world</span><span class="k">))</span>
</pre></div>
</div>
<p>This snippet will produce the following output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>RESPONSE = Hello world!
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Makefile Functions</a><ul>
<li><a class="reference internal" href="#python-eval">python-eval</a></li>
<li><a class="reference internal" href="#python-exec">python-exec</a></li>
<li><a class="reference internal" href="#python-file">python-file</a></li>
<li><a class="reference internal" href="#python-mod">python-mod</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="installing_using.html"
                        title="previous chapter">Installing and Using</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="python_funcs.html"
                        title="next chapter">Python Functions</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/makefile_funcs.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="python_funcs.html" title="Python Functions"
             >next</a> |</li>
        <li class="right" >
          <a href="installing_using.html" title="Installing and Using"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Py-gnumake 0.2 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Benjamin Fogle.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.0.3.
    </div>
  </body>
</html>